# Login copied from browser works!
curl 'https://archiveofourown.org/users/login' -X POST -H 'Cookie: _otwarchive_session=eyJfcmFpbHMiOnsibWVzc2FnZSI6ImV5SnpaWE56YVc5dVgybGtJam9pWXpaaE56YzFZalptTURjNVpUa3lOMlkzWldFNVlXSXdZek13TmpGbE5HTWlMQ0pmWTNOeVpsOTBiMnRsYmlJNklsRlVNVFpxVW1WYU1rOTNhR3BQTnpZeGRXOXNWMmhUWjJsUk1XRnhYMU5NVldseU5GTkNNM0k1VTFFaWZRPT0iLCJleHAiOiIyMDI0LTEwLTAxVDIyOjIyOjEwLjczMVoiLCJwdXIiOiJjb29raWUuX290d2FyY2hpdmVfc2Vzc2lvbiJ9fQ%3D%3D--a75c74a2e0ebd6fccb19d5493a2f1baccdb3a30f; _cfuvid=Kq63TS5d43dcL9uu7NXrKJ.O1dKoN.e9X_cSNAG4.IA-1726516080152-0.0.1.1-604800000; cf_clearance=Nut5MPr_3MgN1ECF4z5NlCYour4eFFMfp.APKdkP2tU-1726610557-1.2.1.1-4KAXb5U8ifk05P42upBmr6WtA80Bgv4x91BCFDH2E2ZdAtEux9EyUi3.HLTsqty2sGaqzpC0FBkG0yO_Hsh55MXXQwa_L_lvmBme5WSa4ofO7J37FewIkrsUtiuycfHIzkg.0YIOwCvgCJjTQBGqI4eK0m7Idag0SCKTFxWFnxbqK0ftoUZ3poUQdW_DnJuOkK0j12FGsr5tB_zotv29j_fxqPYAQtm4tuHLADYuhthFriEXa29EuNID1kW4uK349tfFRRDj9OBziceOBzSKR4keoUfFqXLZ2NICuN8v22XH2FKban76CPpnNHMiNBtQ8hkRigWj0drdq2fKiIOXGn6dcvbWK6LZ16GGZCXe3z8; __cf_bm=UQaP77RgYIo1MkNdOiEY3hqv0gYepGZrWSFp6CXDATU-1726611730-1.0.1.1-6zY5HHS5TvQNFwBCP81npAVERf_kxUQ69.vWSsUZzbANu5WZ.5ZZkhgYmB4dlPRGTVusDXnMZwXVRjDQizr0Fw' --data-raw 'authenticity_token=pGfgpXkd7yFOFJNwBI6rcpIEu-RzFvCz05-NGBkeArWtBkVW0rEVyiEkxR_Wc_KHnbPJq3iO04utxScY858SXg&user%5Blogin%5D=daffidill23&user%5Bpassword%5D=f1%40mingAdr%40g0n&user%5Bremember_me%5D=1&commit=Log+In'

# Login with copied token works!
TOKEN=pGfgpXkd7yFOFJNwBI6rcpIEu-RzFvCz05-NGBkeArWtBkVW0rEVyiEkxR_Wc_KHnbPJq3iO04utxScY858SXg
curl 'https://archiveofourown.org/users/login' -X POST -H 'Cookie: _otwarchive_session=eyJfcmFpbHMiOnsibWVzc2FnZSI6ImV5SnpaWE56YVc5dVgybGtJam9pWXpaaE56YzFZalptTURjNVpUa3lOMlkzWldFNVlXSXdZek13TmpGbE5HTWlMQ0pmWTNOeVpsOTBiMnRsYmlJNklsRlVNVFpxVW1WYU1rOTNhR3BQTnpZeGRXOXNWMmhUWjJsUk1XRnhYMU5NVldseU5GTkNNM0k1VTFFaWZRPT0iLCJleHAiOiIyMDI0LTEwLTAxVDIyOjIyOjEwLjczMVoiLCJwdXIiOiJjb29raWUuX290d2FyY2hpdmVfc2Vzc2lvbiJ9fQ%3D%3D--a75c74a2e0ebd6fccb19d5493a2f1baccdb3a30f; _cfuvid=Kq63TS5d43dcL9uu7NXrKJ.O1dKoN.e9X_cSNAG4.IA-1726516080152-0.0.1.1-604800000; cf_clearance=Nut5MPr_3MgN1ECF4z5NlCYour4eFFMfp.APKdkP2tU-1726610557-1.2.1.1-4KAXb5U8ifk05P42upBmr6WtA80Bgv4x91BCFDH2E2ZdAtEux9EyUi3.HLTsqty2sGaqzpC0FBkG0yO_Hsh55MXXQwa_L_lvmBme5WSa4ofO7J37FewIkrsUtiuycfHIzkg.0YIOwCvgCJjTQBGqI4eK0m7Idag0SCKTFxWFnxbqK0ftoUZ3poUQdW_DnJuOkK0j12FGsr5tB_zotv29j_fxqPYAQtm4tuHLADYuhthFriEXa29EuNID1kW4uK349tfFRRDj9OBziceOBzSKR4keoUfFqXLZ2NICuN8v22XH2FKban76CPpnNHMiNBtQ8hkRigWj0drdq2fKiIOXGn6dcvbWK6LZ16GGZCXe3z8; __cf_bm=UQaP77RgYIo1MkNdOiEY3hqv0gYepGZrWSFp6CXDATU-1726611730-1.0.1.1-6zY5HHS5TvQNFwBCP81npAVERf_kxUQ69.vWSsUZzbANu5WZ.5ZZkhgYmB4dlPRGTVusDXnMZwXVRjDQizr0Fw' --data-raw "authenticity_token=${TOKEN}&user%5Blogin%5D=daffidill23&user%5Bpassword%5D=f1%40mingAdr%40g0n&user%5Bremember_me%5D=1&commit=Log+In"

# Login with brand new fetched token WORKS!!!!!!!!!!!!!!
TOKEN=$(curl -s -c cookies.txt "https://archiveofourown.org/token_dispenser.json" | jq -r '.token') && echo "${TOKEN}"
curl 'https://archiveofourown.org/users/login' -X POST -b cookies.txt --data-raw "authenticity_token=${TOKEN}&user%5Blogin%5D=daffidill23&user%5Bpassword%5D=f1%40mingAdr%40g0n&user%5Bremember_me%5D=1&commit=Log+In"


# Kudos from browser works
curl 'https://archiveofourown.org/kudos.js' -X POST -H 'Cookie: _otwarchive_session=eyJfcmFpbHMiOnsibWVzc2FnZSI6ImV5SnpaWE56YVc5dVgybGtJam9pTkRKbFpqWTBZalZqTW1aaU56TXpOV0psWmpsaE9UazRORFZtWldabE9UVWlMQ0pmWTNOeVpsOTBiMnRsYmlJNklpMU5TVUV6UmpKVU1ubE9OVTlsY1ZGMk9ESXdiR3BHVERkbWVWUmZOalpaV21KVlprOW1Va1kzTUdzaWZRPT0iLCJleHAiOiIyMDI0LTEwLTAxVDIyOjUwOjE2LjQ1MloiLCJwdXIiOiJjb29raWUuX290d2FyY2hpdmVfc2Vzc2lvbiJ9fQ%3D%3D--6eccffa9e3dd11cab0f876b2b4ceafaff491bd0d; _cfuvid=Kq63TS5d43dcL9uu7NXrKJ.O1dKoN.e9X_cSNAG4.IA-1726516080152-0.0.1.1-604800000; __cf_bm=248ZV9xcrt0GR9V3.iLk8IKbO5XXotoZX2AqEmJ8Xr4-1726613405-1.0.1.1-_TZtUB_MMr3nivAckXcK9ImIqAocpUEllBzGfZ6LA_lrL1s1_3Mak_yT.6U1QP0eMUn.gkQlv4uDp1TOKVh7Yw; cf_clearance=6XOgcRVZJSnRXI7LnaRevvxEKiPZ5yLjFMcxLHwcTKY-1726613406-1.2.1.1-ls6pLhX6arLb8KOok2xoMH314a35DPJkfU5lG7WjdVNZAq15D7hLrm3PfVyDaztlqs4mqwJ3u62x5tHJIr8TabmeqbwUdVpLCNQAOv.0T5prU7SoZbkJYdZNVXE2iwtRDKDm2g6RRkC73SDvAyGVfZW8qR99lpLcU4W3q2fWZ98dbEcmFtY.yc2TqbreidDzsxcnYUBdvr6VwaDeLIdivOcgwrcUHYTyiTO8FPl8xcs5jvumgycsAwrlzovN8a6PNmVx7zTCwsm22oBvOUc2kOHpV_9Cm98UmWHUhc7NgE3CQYJWrnuiMUcsWnkI.AseLju.6_w1TI7Z0fJBMsK373WnowR3wVhmutZchq89E30' --data-raw 'authenticity_token=sa_hCeQAykCA3WeyRWkHRauzugI9yhPYUTPdmKEvZWKuZCXvIs5kBq4OOmVCV_T-CY_mkNO_UCHS-m71CmH2EQ&kudo%5Bcommentable_id%5D=39849978&kudo%5Bcommentable_type%5D=Work'

# Kudos with copied token works!
TOKEN=sa_hCeQAykCA3WeyRWkHRauzugI9yhPYUTPdmKEvZWKuZCXvIs5kBq4OOmVCV_T-CY_mkNO_UCHS-m71CmH2EQ
curl 'https://archiveofourown.org/kudos.js' -X POST -H 'Cookie: _otwarchive_session=eyJfcmFpbHMiOnsibWVzc2FnZSI6ImV5SnpaWE56YVc5dVgybGtJam9pTkRKbFpqWTBZalZqTW1aaU56TXpOV0psWmpsaE9UazRORFZtWldabE9UVWlMQ0pmWTNOeVpsOTBiMnRsYmlJNklpMU5TVUV6UmpKVU1ubE9OVTlsY1ZGMk9ESXdiR3BHVERkbWVWUmZOalpaV21KVlprOW1Va1kzTUdzaWZRPT0iLCJleHAiOiIyMDI0LTEwLTAxVDIyOjUwOjE2LjQ1MloiLCJwdXIiOiJjb29raWUuX290d2FyY2hpdmVfc2Vzc2lvbiJ9fQ%3D%3D--6eccffa9e3dd11cab0f876b2b4ceafaff491bd0d; _cfuvid=Kq63TS5d43dcL9uu7NXrKJ.O1dKoN.e9X_cSNAG4.IA-1726516080152-0.0.1.1-604800000; __cf_bm=248ZV9xcrt0GR9V3.iLk8IKbO5XXotoZX2AqEmJ8Xr4-1726613405-1.0.1.1-_TZtUB_MMr3nivAckXcK9ImIqAocpUEllBzGfZ6LA_lrL1s1_3Mak_yT.6U1QP0eMUn.gkQlv4uDp1TOKVh7Yw; cf_clearance=6XOgcRVZJSnRXI7LnaRevvxEKiPZ5yLjFMcxLHwcTKY-1726613406-1.2.1.1-ls6pLhX6arLb8KOok2xoMH314a35DPJkfU5lG7WjdVNZAq15D7hLrm3PfVyDaztlqs4mqwJ3u62x5tHJIr8TabmeqbwUdVpLCNQAOv.0T5prU7SoZbkJYdZNVXE2iwtRDKDm2g6RRkC73SDvAyGVfZW8qR99lpLcU4W3q2fWZ98dbEcmFtY.yc2TqbreidDzsxcnYUBdvr6VwaDeLIdivOcgwrcUHYTyiTO8FPl8xcs5jvumgycsAwrlzovN8a6PNmVx7zTCwsm22oBvOUc2kOHpV_9Cm98UmWHUhc7NgE3CQYJWrnuiMUcsWnkI.AseLju.6_w1TI7Z0fJBMsK373WnowR3wVhmutZchq89E30' --data-raw "authenticity_token=${TOKEN}&kudo%5Bcommentable_id%5D=39849978&kudo%5Bcommentable_type%5D=Work"

# kudos with fresh token WORKS!!!!
TOKEN=$(curl -s -c cookies.txt "https://archiveofourown.org/token_dispenser.json" | jq -r '.token') && echo "${TOKEN}"
curl 'https://archiveofourown.org/kudos.js' -X POST -b cookies.txt --data-raw "authenticity_token=${TOKEN}&kudo%5Bcommentable_id%5D=39849978&kudo%5Bcommentable_type%5D=Work"

# chained commands
TOKEN=$(curl -s -c cookies.txt "https://archiveofourown.org/token_dispenser.json" | jq -r '.token') && echo "${TOKEN}"
curl 'https://archiveofourown.org/users/login' -X POST -b cookies.txt --data-raw "authenticity_token=${TOKEN}&user%5Blogin%5D=daffidill23&user%5Bpassword%5D=f1%40mingAdr%40g0n&user%5Bremember_me%5D=1&commit=Log+In"
curl 'https://archiveofourown.org/kudos.js' -X POST -b cookies.txt --data-raw "authenticity_token=${TOKEN}&kudo%5Bcommentable_id%5D=58985182&kudo%5Bcommentable_type%5D=Work"

TOKEN=$(curl -s -c cookies.txt "https://archiveofourown.org/token_dispenser.json" | jq -r '.token') && echo "${TOKEN}"
curl 'https://archiveofourown.org/kudos.js' -X POST -b cookies.txt --data-raw "authenticity_token=${TOKEN}&kudo%5Bcommentable_id%5D=58985182&kudo%5Bcommentable_type%5D=Work"

URL="https://archiveofourown.org/works/58985182"
echo ${URL##/*/}